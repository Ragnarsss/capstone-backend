# Configuracion de Apache para proxy de WebSocket al servicio Node.js

<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Proxy inverso para el servicio Node.js
    # Redirige /asistencia/* al contenedor node-service
    ProxyPreserveHost On

    # Proxy WebSocket - DEBE ir ANTES del proxy HTTP general
    # La regla mas especifica debe estar primero
    ProxyPass /asistencia/ws ws://node-service:3000/ws
    ProxyPassReverse /asistencia/ws ws://node-service:3000/ws

    # Proxy HTTP normal - va despues del WebSocket
    ProxyPass /asistencia http://node-service:3000
    ProxyPassReverse /asistencia http://node-service:3000

    # Logs
    ErrorLog /var/log/httpd/error.log
    CustomLog /var/log/httpd/access.log combined
</VirtualHost>
